
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>酒店管理系统</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/jquery-ui.css"/>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">管理员系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/tuichu">退出登录</a></li>
            </ul>

        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul id="main-nav" class="nav nav-tabs nav-stacked" style="">
                <li><a href="#"> <i class="glyphicon glyphicon-credit-card"></i>入住管理</a></li>
                <li><a href="/datang">大堂入住</a></li>
                <li><a href="/dingdan">订单入住</a></li>
                <li><a href="/unsubscribe"><i class="glyphicon glyphicon-user"></i>退房管理</a></li>
                <li><a href="/record"><i class="glyphicon glyphicon-asterisk"></i>记录查询</a></li>
                <li><a href="/category"><i class="glyphicon glyphicon-th-list"></i>房间类别</a></li>
                <li><a href="/room"><i class="glyphicon glyphicon-fire"></i>房间管理</a></li>
                <li><a href="/roomState"><i class="glyphicon glyphicon-fire"></i>房间状态</a></li>
                <li><a href="/modify"><i class="glyphicon glyphicon-cog"></i>修改密码</a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">订单查询</h1>
            <div>
                <input type="text" class="form-control searching" placeholder="请输入联系人或联系电话" style="width: 200px; display: inline-block!important;">
                <input type="button" class="btn btn-default" value="查询订单">
            </div>

            <form>
                <div class="row detail">
                    <h3>订单详情</h3>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">订单号</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control did" name="did" placeholder="订单号">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">入住日期</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control comedate" name="comedate" placeholder="入住日期">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">离店日期</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control godate" name="godate" placeholder="离店日期">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">房间类型</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control category" name="category" placeholder="离店日期">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">预定数量</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control n" name="n" placeholder="数量">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">入住人姓名</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control allname" name="allname" placeholder="姓名">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">联系人</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control contname" name="contname" placeholder="联系人">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">联系电话</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control tel" name="tel" placeholder="联系电话">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">留言</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control words" name="words" placeholder="留言">
                        </div>
                    </div>
                </div>
                <div class="row check">
                    <h3 class="form-group col-sm-8">办理入住</h3>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">价格</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control price" name="price">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">房间号</label>
                        <div class="col-sm-2">
                            <select name="num" class="num" >

                            </select>
                        </div>
                    </div>
                </div>
                <div class="row customer_info">
                    <h3 class="form-group col-sm-8">顾客信息</h3>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">证件类型</label>
                        <div class="col-sm-2">
                            <select type="text" class="form-control card" name="">
                                <option value="身份证">身份证</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">证件号码</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control cardnum" name="">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">姓名</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control name" name="name">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">性别</label>
                        <div class="col-sm-2">
                            <select type="text" class="form-control sex" name="">
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="button" class="btn btn-success torecord">办理入住</button>
                        </div>
                    </div>

                </div>
            </form>

        </div>
    </div>
</div>
<script>
    $(".searching").blur(function(){
        var a=$(this).val();
        console.log(a);
        $.get("/searchOrder/"+a,function(data){
            if(!data.result){
                alert("查无此人");
                return;
            }
            console.log(data.result);
            var b=data.result;
            $(".did").val(b._id);
            $(".comedate").val(b.comedate);
            $(".godate").val(b.godate);
            $(".category").val(b.category);
            $(".n").val(b.n);
            $(".name").val(b.name);
            $(".allname").val(b.name);
            $(".contname").val(b.contname);
            $(".tel").val(b.tel);
            $(".words").val(b.words);
            $(".detail div div input[type=text]").attr("readonly");
            $.get("/getRoomNum/"+b.category,function(d){
                for(var i=0;i<d.nums.length;i++){
                    var opt=$("<option>"+d.nums[i]+"</option>");
                    $(".num").append(opt);
                }
                $(".price").val(d.price);
            })
        })
    })
    $(".searching").focus(function(){
        $(':input','form')
            .not(':button, :submit, :reset, :hidden')
            .val('')
    })
    $(".torecord").click(function(){
        var cid=$(".did").val();
        var n=$(".num").val();

        $.ajax({
            url:"/deleteOrder/"+cid,
            type: "delete",
            success:function(d){
                if(d.result==1){
                    $.get("/updateStatere/"+n,function(data) {
                        if (data.result == 1) {
                            $.post("/addRecord", {
                                card: $(".card").val(),
                                cardnum: $(".cardnum").val(),
                                name: $(".name").val(),
                                sex: $(".sex").val(),
                                category: $(".category").val(),
                                num: $(".num").val(),
                                unitprice: $(".price").val(),
                                allname: $(".allname").val(),
                                comedate: $(".comedate").val(),
                                godate: $(".godate").val(),
                                allprice:"/",
                                rstate:"已入住"
                            }, function (data) {
                                if (data.result == 1) {
                                    alert("办理成功！");
                                    $("input[type=text]").val("");
                                    window.location.reload();
                                } else if (data.result == -1) {
                                    alert("办理失败");
                                } else if (data.result == -2) {
                                    alert("服务器错误！请联系管理员，怎么联系我也不知道！");
                                }
                            })
                        } else {
                            alert("服务器错误！请联系管理员，怎么联系我也不知道！");
                        }
                    })
                }
            }
        })

    })
</script>
</body>
</html>
