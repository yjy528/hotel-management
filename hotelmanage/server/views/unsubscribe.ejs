
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>酒店管理系统</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/jquery-ui.css"/>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">管理员系统</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/tuichu">退出登录</a></li>
            </ul>

        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul id="main-nav" class="nav nav-tabs nav-stacked" style="">
                <li><a href="#"> <i class="glyphicon glyphicon-credit-card"></i>入住管理</a></li>
                <li><a href="/datang">大堂入住</a></li>
                <li><a href="/dingdan">订单入住</a></li>
                <li><a href="/unsubscribe"><i class="glyphicon glyphicon-user"></i>退房管理</a></li>
                <li><a href="/record"><i class="glyphicon glyphicon-asterisk"></i>记录查询</a></li>
                <li><a href="/category"><i class="glyphicon glyphicon-th-list"></i>房间类别</a></li>
                <li><a href="/room"><i class="glyphicon glyphicon-fire"></i>房间管理</a></li>
                <li><a href="/roomState"><i class="glyphicon glyphicon-fire"></i>房间状态</a></li>
                <li><a href="/modify"><i class="glyphicon glyphicon-cog"></i>修改密码</a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">退房管理</h1>
            <div>
                <input type="text" class="form-control searching" placeholder="请输入房间号" style="width: 200px; display: inline-block!important;">
                <input type="button" class="btn btn-default" value="查询订单">
            </div>

            <form>
                <div class="row customer_info">
                    <h3 class="form-group col-sm-8">顾客信息</h3>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">证件类型</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control card" name="" value="身份证">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">证件号码</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control cardnum" name="">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">姓名</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control name" name="name">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">性别</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control sex" name="sex">
                        </div>
                    </div>
                </div>
                <div class="row detail">
                    <h3>订单详情</h3>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">订单号</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control did" name="did" placeholder="订单号">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">房间号</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control num" name="num" placeholder="房间号">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">房间类型</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control category" name="category" placeholder="房间类型">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">入住日期</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control comedate" name="comedate" placeholder="入住日期">
                        </div>
                    </div>

                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">入住人姓名</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control allname" name="allname" placeholder="姓名">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">入住天数</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control datecount" name="datecount" placeholder="天数">
                        </div>
                        <label for="inputEmail3" class="col-sm-2 control-label">价格（元/每天）</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control price" name="price">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <label for="inputEmail3" class="col-sm-2 control-label">消费金额</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control allprice" name="allprice" placeholder="总金额">
                        </div>
                    </div>
                    <div class="form-group col-sm-8">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="button" class="btn btn-success torecord">办理退房</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    function add0(m){return m<10?'0'+m:m }
    function format(shijianchuo){
//shijianchuo是整数，否则要parseInt转换
        var time = new Date(shijianchuo);
        var y = time.getFullYear();
        var m = time.getMonth()+1;
        var d = time.getDate();
        return y+'-'+add0(m)+'-'+add0(d);
    }
    function count(da){
        var date1=new Date(da);
        var date2=new Date(format(new Date()));
        var date=(date2.getTime()-date1.getTime())/(1000*60*60*24);/*不用考虑闰年否*/
        return date;
    }

    $(".searching").blur(function(){

        var a=$(this).val();
        console.log(a);
        $.get("/searchRecordNum/"+a,function(data){
            if(!data.result){
                alert("没有相关信息");
                return;
            }
            console.log(data.result);
            var b=data.result;
            $(".did").val(b._id);
            $(".card").val(b.card);
            $(".cardnum").val(b.cardnum);
            $(".sex").val(b.sex);
            $(".comedate").val(b.comedate);
            $(".godate").val(b.godate);
            $(".category").val(b.category);
            $(".num").val(b.num);
            $(".n").val(b.n);
            $(".name").val(b.name);
            $(".allname").val(b.name);

            var c=b.comedate;
            $(".datecount").val(count(c));

            $(".torecord").attr("data-date",b.com)
            $(".detail div div input[type=text]").attr("readonly");
            $.get("/getRoomNum/"+b.category,function(d){
                $(".price").val(d.price);
                // console.log($(".price").val()*$(".datecount").val());
                var ap=$(".price").val()*$(".datecount").val();
                $(".allprice").val(ap);
            })

        })
    })
    $(".searching").focus(function(){
        $(':input','form')
            .not(':button, :submit, :reset, :hidden')
            .val('')
    })
    $(".torecord").click(function(){
        var n=$(".num").val();
        var da=format(new Date());
        $.post("/tuifang/"+n, {
            godate: da,
            allprice:$(".allprice").val(),
            rstate:"已退房"
        }, function (data) {
            if (data.result == 1) {
                alert("退房成功！");
                $("input[type=text]").val("");
                $.get("/updateStatereturn/"+n,function(data) {
                    if (data.result == 1) {

                    } else {
                        alert("服务器错误！请联系管理员，怎么联系我也不知道！");
                    }
                })
                window.location.reload();
            } else if (data.result == -1) {
                alert("退房失败");
            } else if (data.result == -2) {
                alert("服务器错误！请联系管理员，怎么联系我也不知道！");
            }
        })

    })

</script>
</body>
</html>
